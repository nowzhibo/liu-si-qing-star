<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>åˆ˜æ€æ™´ Â· ç”Ÿæ—¥å¿«ä¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: radial-gradient(circle at center, #0a0f2c, #000);
    font-family: "Microsoft YaHei", sans-serif;
}

/* ä¿¡æ¯æ–‡å­—ä½ç½®ï¼ˆå·²ä¿®å¤ï¼æ‰‹æœºç«¯ç”Ÿæ•ˆï¼‰ */
#message {
    position: absolute;
    top: 58%;
    left: 50%;
    transform: translateX(-50%);
    color: #fff;
    font-size: 0.95rem;
    font-weight: 300;
    text-align: center;
    opacity: 0;
    line-height: 1.6;
    text-shadow: 0 0 12px #fff;
    width: 90%;
    max-width: 380px;
}

/* æç¤ºæ–‡å­— */
#hint {
    position: absolute;
    bottom: 50px;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 0.65rem;
    opacity: 0.7;
}

</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="message"></div>
<div id="hint">ğŸ’« ç‚¹å‡»å±å¹•ï¼Œå¼€å¯æµªæ¼«æ˜Ÿç©ºä¸ç”Ÿæ—¥ç¥ç¦ ğŸ’«</div>

<!-- èƒŒæ™¯éŸ³ä¹ -->
<audio id="bgMusic" loop playsinline preload="auto" muted>
  <source src="https://cdn.jsdelivr.net/gh/huqing/river_flows_in_you.mp3" type="audio/mpeg">
</audio>

<!-- ç‚¹å‡»éŸ³æ•ˆ -->
<audio id="clickSound" preload="auto">
  <source src="https://cdn.jsdelivr.net/gh/huqing/click.mp3" type="audio/mpeg">
</audio>

<script>
/* ------------------------
   Canvas åˆå§‹åŒ–
------------------------ */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let stars = [];
let floatingHearts = [];
let sakura = [];
let meteors = [];
let cakes = [];

let clickCount = 0;

/* ç”Ÿæ—¥æµªæ¼«æ–‡æ¡ˆ */

let messageText = [
  // ç¬¬ä¸€æ¬¡ç‚¹å‡» â†’ å¿ƒå½¢åŠ¨ç”»
  "åˆ˜æ€æ™´ï¼Œè®¤è¯†ä½ æ‰ä¸€å‘¨ï¼Œä½†ä½ çš„ç¬‘å®¹å·²æ‚„æ‚„å æ®äº†æˆ‘çš„å¿ƒã€‚<br>åœ¨è¿™ä¸ªç‰¹åˆ«çš„æ—¥å­é‡Œï¼Œæˆ‘åªæƒ³è®©ä½ çŸ¥é“ï¼Œä½ å€¼å¾—è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼Œæ¯ä¸€é¢—æ˜Ÿéƒ½ä¸ºä½ é—ªçƒã€‚",

  // ç¬¬äºŒæ¬¡ç‚¹å‡» â†’ åå­—æ˜Ÿåº§åŠ¨ç”»
  "è¿™ä¸€å‘¨ï¼Œæˆ‘çœ‹è§äº†ä½ ç‹¬ç‰¹çš„ç¾å¥½â€”â€”ä½ çš„æ¸©æš–ã€ä½ çš„åŠªåŠ›ã€ä½ çš„å¯çˆ±ã€‚<br>å¸Œæœ›æœªæ¥çš„æ¯ä¸€å¤©ï¼Œæˆ‘éƒ½èƒ½åœ¨ä½ èº«è¾¹ï¼Œåšä½ å¾®ç¬‘çš„ç†ç”±ï¼Œä¹Ÿæˆä¸ºä½ ç–²æƒ«æ—¶çš„æ¸¯æ¹¾ã€‚",

  // ç¬¬ä¸‰æ¬¡ç‚¹å‡» â†’ æ¨±èŠ±æµæ˜Ÿè›‹ç³•ç²’å­
  "æ‰€ä»¥ï¼Œåœ¨ä½ çš„ç”Ÿæ—¥è¿™å¤©ï¼Œæˆ‘æƒ³è¯´ä¸€å¥è¯ï¼Œè—åœ¨å¿ƒåº•å·²ä¹…ï¼š<br><b>æˆ‘å–œæ¬¢ä½ ï¼Œæƒ³åœ¨ä½ çš„æ¯ä¸ªç”Ÿæ—¥ã€æ¯ä¸ªå¹³å‡¡çš„æ—¥å­é‡Œï¼Œé™ªä¼´ä½ ã€å®ˆæŠ¤ä½ ï¼Œä¸ç¦»ä¸å¼ƒã€‚</b><br>ç”Ÿæ—¥å¿«ä¹ï¼Œåˆ˜æ€æ™´ â¤ï¸<br>è¿™ä¸€åˆ»çš„æ˜Ÿå…‰éƒ½ä¸ºä½ åœç•™ï¼Œæˆ‘ä¹Ÿæ„¿ä¸ºä½ åœç•™ã€‚"
];


/* ------------------------
   æ˜Ÿæ˜Ÿåˆå§‹åŒ–
------------------------ */
for (let i = 0; i < 300; i++) {
    stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        size: Math.random() * 2,
        dx: Math.random() * 0.6 - 0.3,
        dy: Math.random() * 0.6 - 0.3
    });
}

/* ------------------------
   å¿ƒå½¢è·¯å¾„ï¼ˆæ˜Ÿæ˜Ÿæ±‡èšç”¨ï¼‰
------------------------ */
let heart = [];
for (let a = 0; a < Math.PI * 2; a += 0.1) {
    let x = 16 * Math.pow(Math.sin(a), 3);
    let y = 13 * Math.cos(a) - 5 * Math.cos(2*a) - 2 * Math.cos(3*a) - Math.cos(4*a);
    heart.push({x: x, y: -y});
}

/* ------------------------
   â€œåˆ˜æ€æ™´â€ â†’ æ˜Ÿåº§ç‚¹é˜µ
   ç”ŸæˆåŠ¨æ€æ˜Ÿæ˜Ÿç›®æ ‡åæ ‡
------------------------ */
let namePoints = [];
function generateNamePoints() {
    let offCanvas = document.createElement("canvas");
    let offCtx = offCanvas.getContext("2d");
    offCanvas.width = 800;
    offCanvas.height = 200;

    offCtx.fillStyle = "#fff";
    offCtx.font = "bold 120px Microsoft YaHei";
    offCtx.fillText("åˆ˜æ€æ™´", 20, 140);

    let img = offCtx.getImageData(0,0,800,200);
    let data = img.data;

    for (let y = 0; y < 200; y += 4) {
        for (let x = 0; x < 800; x += 4) {
            let index = (y * 800 + x) * 4;
            if (data[index + 3] > 128) {
                namePoints.push({
                    x: x - 400,
                    y: y - 100
                });
            }
        }
    }
}
generateNamePoints();

/* ------------------------
   Pointer è·Ÿéš
------------------------ */
let pointer = {x: canvas.width/2, y: canvas.height/2};
document.addEventListener('mousemove', (e)=>{
    pointer.x = e.clientX;
    pointer.y = e.clientY;
});

/* ------------------------
   æ¨±èŠ±é£˜è½
------------------------ */
function createSakura() {
    for (let i = 0; i < 4; i++) {
        sakura.push({
            x: Math.random()*canvas.width,
            y: -20,
            size: 8+Math.random()*6,
            speed: 0.5+Math.random()*1,
            drift: Math.random()*1.5
        });
    }
}

/* ------------------------
   æµæ˜Ÿ
------------------------ */
function createMeteor() {
    meteors.push({
        x: Math.random()*canvas.width,
        y: -20,
        dx: -4 - Math.random()*4,
        dy: 4 + Math.random()*4,
        length: 80+Math.random()*50
    });
}

/* ------------------------
   è›‹ç³•ç²’å­ä¸Šå‡
------------------------ */
function createCakeParticles() {
    for (let i=0;i<3;i++){
        cakes.push({
            x: canvas.width/2 + (Math.random()*100 - 50),
            y: canvas.height + 20,
            size: 6 + Math.random()*4,
            speed: 1 + Math.random()*1,
            alpha: 1
        });
    }
}

/* ------------------------
   åœ£è¯çˆ±å¿ƒæ ‘ï¼ˆä¿ç•™ï¼‰
------------------------ */
let treeHearts = [];
function drawChristmasTree() {
    const treeX = canvas.width - 180;
    const treeY = canvas.height - 180;
    const layers = 4;
    const layerHeight = 30;
    const baseWidth = 80;

    for (let i=0; i<layers; i++) {
        ctx.beginPath();
        let w = baseWidth - i*15;
        ctx.moveTo(treeX, treeY - i*layerHeight);
        ctx.lineTo(treeX - w/2, treeY + layerHeight - i*layerHeight);
        ctx.lineTo(treeX + w/2, treeY + layerHeight - i*layerHeight);
        ctx.closePath();
        ctx.fillStyle = "rgba(0,200,0,0.9)";
        ctx.shadowColor="#0f0";
        ctx.shadowBlur=10;
        ctx.fill();
    }

    ctx.fillStyle="#8B4513";
    ctx.fillRect(treeX-12, treeY+10, 24, 40);

    ctx.beginPath();
    ctx.arc(treeX, treeY - layers*layerHeight - 5, 6, 0, Math.PI*2);
    ctx.fillStyle="yellow";
    ctx.shadowColor="yellow";
    ctx.shadowBlur=15;
    ctx.fill();

    if(treeHearts.length < 10){
        for(let i=0;i<10-treeHearts.length;i++){
            let offsetX = Math.random()*baseWidth - baseWidth/2;
            let offsetY = Math.random()*layers*layerHeight - layers*layerHeight;
            treeHearts.push({x: treeX + offsetX, y: treeY + offsetY, alpha: Math.random(), delta: 0.02 + Math.random()*0.03});
        }
    }

    treeHearts.forEach(h=>{
        h.alpha += h.delta;
        if(h.alpha > 1 || h.alpha < 0) h.delta*=-1;
        ctx.beginPath();
        ctx.arc(h.x,h.y,5,0,Math.PI*2);
        ctx.fillStyle=`rgba(255,0,0,${h.alpha})`;
        ctx.fill();
    });
}

/* ------------------------
   ä¸»æ¸²æŸ“
------------------------ */
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    /* æ˜Ÿæ˜Ÿ */
    stars.forEach(s=>{
        s.x += s.dx;
        s.y += s.dy;
        if(s.x<0||s.x>canvas.width) s.dx*=-1;
        if(s.y<0||s.y>canvas.height) s.dy*=-1;

        ctx.beginPath();
        ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
        ctx.fillStyle="rgba(255,255,255,0.9)";
        ctx.shadowColor="#fff";
        ctx.shadowBlur=6;
        ctx.fill();

        s.x += (pointer.x - s.x) * 0.0005;
        s.y += (pointer.y - s.y) * 0.0005;
    });

    /* æ¨±èŠ± */
    sakura.forEach((p,i)=>{
        p.y += p.speed;
        p.x += Math.sin(p.y/20)*p.drift;
        ctx.beginPath();
        ctx.fillStyle="rgba(255,183,197,0.9)";
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fill();
        if(p.y > canvas.height) sakura.splice(i,1);
    });

    /* æµæ˜Ÿ */
    meteors.forEach((m,i)=>{
        ctx.beginPath();
        ctx.strokeStyle="white";
        ctx.lineWidth=2;
        ctx.moveTo(m.x,m.y);
        ctx.lineTo(m.x+m.length*m.dx*0.1, m.y+m.length*m.dy*0.1);
        ctx.stroke();

        m.x += m.dx;
        m.y += m.dy;
        if(m.y > canvas.height) meteors.splice(i,1);
    });

    /* è›‹ç³•ç²’å­ */
    cakes.forEach((c,i)=>{
        c.y -= c.speed;
        c.alpha -= 0.01;
        ctx.beginPath();
        ctx.fillStyle=`rgba(255,200,150,${c.alpha})`;
        ctx.arc(c.x,c.y,c.size,0,Math.PI*2);
        ctx.fill();
        if(c.alpha <= 0) cakes.splice(i,1);
    });

    /* åœ£è¯æ ‘ */
    drawChristmasTree();

    requestAnimationFrame(draw);
}
draw();

/* ------------------------
   æ–‡å­—é€å­—æ˜¾ç¤º
------------------------ */
function typeWriter(text, i=0) {
    const msg = document.getElementById("message");
    if(i < text.length){
        msg.innerHTML = text.substring(0, i+1);
        msg.style.opacity = 1;
        msg.style.textShadow = `0 0 ${8 + i/4}px #fff`;
        setTimeout(()=>typeWriter(text,i+1), 35);
    }
}

/* ------------------------
   ç‚¹å‡»äº‹ä»¶
------------------------ */
const music = document.getElementById("bgMusic");
const clickSound = document.getElementById("clickSound");
const hint = document.getElementById("hint");

canvas.addEventListener("click", ()=>{
    hint.style.display="none";

    /* æ’­æ”¾éŸ³ä¹ */
    if(music.paused){
        music.muted=false;
        music.play().catch(()=>{});
    }

    clickSound.currentTime = 0;
    clickSound.play().catch(()=>{});

    clickCount++;

    /* æ˜Ÿæ˜Ÿåæ ‡ä¸­å¿ƒ */
    let cx = canvas.width/2;
    let cy = canvas.height/2;

    if(clickCount === 1){
        /* æ˜Ÿæ˜Ÿèšæˆâ€œå¿ƒå½¢â€ */
        stars.forEach((s,i)=>{
            let target = heart[i % heart.length];
            setInterval(()=>{
                s.x += (cx + target.x*15 - s.x)*0.05;
                s.y += (cy + target.y*15 - s.y)*0.05;
            },20);
        });

        typeWriter(messageText[0]);

    } else if(clickCount === 2){
        /* æ˜Ÿæ˜Ÿèšæˆ â€œåˆ˜æ€æ™´â€ åå­—æ˜Ÿåº§ */
        stars.forEach((s,i)=>{
            let target = namePoints[i % namePoints.length];
            setInterval(()=>{
                s.x += (cx + target.x*0.8 - s.x)*0.05;
                s.y += (cy + target.y*0.8 - s.y)*0.05;
            },20);
        });

        typeWriter(messageText[1]);

    } else if(clickCount === 3){

        /* ç»§ç»­æ¨±èŠ±ã€æµæ˜Ÿã€è›‹ç³•ç²’å­ */
        setInterval(createSakura, 800);
        setInterval(createMeteor, 2000);
        setInterval(createCakeParticles, 500);
        particleEnabled = true;
        typeWriter(messageText[2]);
    }


});
// =======================================
// ğŸ‚ğŸğŸˆ æµç•…ä¸å¡ç‰ˆç”Ÿæ—¥ç²’å­åŠ¨ç”»ï¼ˆæ­£ç¡®ä½ç½®ï¼‰
// =======================================
const cakeCanvas = document.createElement("canvas");
cakeCanvas.width = window.innerWidth;
cakeCanvas.height = window.innerHeight;
cakeCanvas.style.position = "fixed";
cakeCanvas.style.top = "0";
cakeCanvas.style.left = "0";
cakeCanvas.style.pointerEvents = "none";
cakeCanvas.style.zIndex = "10";
document.body.appendChild(cakeCanvas);

const cctx = cakeCanvas.getContext("2d");

const particlesEmoji = ["ğŸ‚", "ğŸ", "ğŸˆ"];

let particles = [];
const MAX_PARTICLES = 40;

// é»˜è®¤ä¸ç”Ÿæˆï¼Œç‚¹å‡»ç¬¬ä¸‰æ¬¡åæ‰å¼€å§‹
let particleEnabled = false;

function createParticle() {
    if (!particleEnabled) return; // åªæœ‰ç¬¬ä¸‰æ¬¡ç‚¹å‡»æ‰ä¼šå¯åŠ¨
    if (particles.length >= MAX_PARTICLES) return;

    const emoji = particlesEmoji[Math.floor(Math.random() * particlesEmoji.length)];

    particles.push({
        x: Math.random() * cakeCanvas.width,
        y: cakeCanvas.height + 40,
        size: 22 + Math.random() * 12,
        speed: 0.6 + Math.random() * 1.2,
        opacity: 1,
        emoji
    });
}

function drawParticles() {
    cctx.clearRect(0, 0, cakeCanvas.width, cakeCanvas.height);

    for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];

        cctx.globalAlpha = p.opacity;
        cctx.font = `${p.size}px serif`;
        cctx.fillText(p.emoji, p.x, p.y);

        p.y -= p.speed;
        p.opacity -= 0.003;

        if (p.opacity <= 0) particles.splice(i, 1);
    }

    requestAnimationFrame(drawParticles);
}

setInterval(createParticle, 600);
drawParticles();

// ==============================
// ğŸ‡ é¦–æ¬¡å¼€åœºå¯†é›†æµªæ¼«çƒŸèŠ± + å®Œæˆåæ˜¾ç¤ºæ–‡å­—
// ==============================
const fireworkCanvas = document.createElement("canvas");
fireworkCanvas.width = window.innerWidth;
fireworkCanvas.height = window.innerHeight;
fireworkCanvas.style.position = "fixed";
fireworkCanvas.style.top = "0";
fireworkCanvas.style.left = "0";
fireworkCanvas.style.pointerEvents = "none";
fireworkCanvas.style.zIndex = "15";
document.body.appendChild(fireworkCanvas);

const fctx = fireworkCanvas.getContext("2d");
let fireworks = [];

class Particle {
    constructor(x, y, color, speed, angle) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.speed = speed;
        this.angle = angle;
        this.alpha = 1;
        this.gravity = 0.02;
    }
    update() {
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + this.gravity;
        this.alpha -= 0.015;
    }
    draw() {
        fctx.globalAlpha = this.alpha;
        fctx.beginPath();
        fctx.fillStyle = this.color;
        fctx.arc(this.x, this.y, 3, 0, Math.PI*2);
        fctx.fill();
    }
}

function launchFireworkRow(count = 8) {
    const spacing = fireworkCanvas.width / (count + 1);
    const colors = ["#ff2d95","#ffba00","#00fff7","#ff3d3d","#8aff00"];
    for(let i = 0; i < count; i++){
        setTimeout(() => {
            const x = spacing * (i + 1);
            const y = fireworkCanvas.height;
            const color = colors[Math.floor(Math.random()*colors.length)];
            fireworks.push({x, y, targetY: fireworkCanvas.height*0.3, exploded:false, color});
        }, i * 80);
    }
}

function drawFireworks() {
    fctx.clearRect(0,0,fireworkCanvas.width, fireworkCanvas.height);
    for (let i = fireworks.length-1; i>=0; i--) {
        let f = fireworks[i];
        if (!f.exploded) {
            f.y -= 4;
            fctx.beginPath();
            fctx.fillStyle = f.color;
            fctx.arc(f.x,f.y,4,0,Math.PI*2);
            fctx.fill();

            if(f.y <= f.targetY){
                f.exploded = true;
                f.particles = [];
                for(let j=0;j<40;j++){
                    const angle = Math.random()*Math.PI*2;
                    const speed = Math.random()*3+1;
                    f.particles.push(new Particle(f.x,f.y,f.color,speed,angle));
                }
            }
        } else {
            f.particles.forEach((p,k)=>{
                p.update();
                p.draw();
                if(p.alpha<=0) f.particles.splice(k,1);
            });
            if(f.particles.length===0) fireworks.splice(i,1);
        }
    }
    requestAnimationFrame(drawFireworks);
}

// ğŸ‰ é¡µé¢é¦–æ¬¡åŠ è½½ï¼Œå¼€åœºå¯†é›†çƒŸèŠ±
launchFireworkRow(50);
drawFireworks();

// --------------------------------
// âœ¨ å¼€åœºæ–‡å­— â€œææ€æ™´ï¼Œç”Ÿæ—¥å¿«ä¹ï¼ˆ12.4ï¼‰â€
// --------------------------------
const openingMessage = document.createElement("div");
openingMessage.style.position = "absolute";
openingMessage.style.top = "50%";
openingMessage.style.left = "50%";
openingMessage.style.transform = "translate(-50%, -50%)";
openingMessage.style.color = "#fff";
openingMessage.style.fontSize = "2rem";
openingMessage.style.fontWeight = "bold";
openingMessage.style.textAlign = "center";
openingMessage.style.opacity = "0";
openingMessage.style.textShadow = "0 0 20px #fff, 0 0 40px #ff2d95, 0 0 60px #ff2d95";
openingMessage.style.pointerEvents = "none";
openingMessage.innerHTML = "ææ€æ™´ï¼Œç”Ÿæ—¥å¿«ä¹ï¼ˆ12.4ï¼‰";
document.body.appendChild(openingMessage);

// æ£€æµ‹é¦–æ¬¡çƒŸèŠ±å®Œæˆ
function checkFireworksComplete() {
    if(fireworks.length === 0){
        showOpeningMessage();
    } else {
        requestAnimationFrame(checkFireworksComplete);
    }
}
requestAnimationFrame(checkFireworksComplete);

function showOpeningMessage() {
    let opacity = 0;
    function fadeIn() {
        opacity += 0.02;
        if(opacity > 1) opacity = 1;
        openingMessage.style.opacity = opacity;
        if(opacity < 1) requestAnimationFrame(fadeIn);
    }
    fadeIn();
}
    

</script>
</body>
</html>
