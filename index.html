<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>åˆ˜æ€æ™´çš„ä¸“å±æ˜Ÿç©ºå‘Šç™½</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: radial-gradient(circle at center, #0a0f2c, #000);
    font-family: "Microsoft YaHei", sans-serif;
}
#message {
    position: absolute;
    top: 54%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-size: 0.9rem;
    font-weight: 300;
    text-align: center;
    opacity: 0;
    line-height: 1.6;
    text-shadow: 0 0 12px #fff;
    word-break: normal;
}
#hint {
    position: absolute;
    bottom: 50px;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 0.5rem;
    opacity: 0.7;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="message"></div>
<div id="hint">ğŸ’« ç‚¹å‡»å±å¹•ï¼Œå¼€å¯ä¸“å±æ˜Ÿç©ºæµªæ¼«éŸ³ä¹ ğŸ’«</div>

<audio id="bgMusic" loop playsinline preload="auto" muted>
  <source src="https://cdn.jsdelivr.net/gh/huqing/river_flows_in_you.mp3" type="audio/mpeg">
</audio>
<audio id="clickSound" preload="auto">
  <source src="https://cdn.jsdelivr.net/gh/huqing/click.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let stars = [];
let heart = [];
let floatingHearts = [];
let clickCount = 0;
let messageText = [
  "ææ€æ™´ï¼Œä½ ä¸ç”¨å†ç‹¬è‡ªæ‰¿æ‹…ä¸€åˆ‡ï¼Œ<br>æ— è®ºå¼€å¿ƒæˆ–éš¾è¿‡ï¼Œæˆ‘éƒ½åœ¨ä½ èº«è¾¹ã€‚<br>æ¯ä¸€é¢—é—ªçƒçš„æ˜Ÿæ˜Ÿï¼Œéƒ½æ˜¯æˆ‘å¯¹ä½ çš„å¿ƒæ„ã€‚<br>æˆ‘å–œæ¬¢ä½ ï¼Œä¹Ÿæ„¿æ„é™ªç€ä½ ï¼Œç»™ä½ æ¸©æš–å’Œå®‰å…¨æ„Ÿã€‚",
  "å¦‚æœå¯ä»¥ï¼Œæˆ‘å¸Œæœ›æ¯å¤©éƒ½è¿™æ ·é™ªä½ ï¼Œ<br>çœ‹æ˜Ÿç©ºã€å¬éŸ³ä¹ï¼Œå“ªæ€•é™é™åœ°åç€ï¼Œä¹Ÿè§‰å¾—å¹¸ç¦ã€‚",
  "æ‰€ä»¥â€¦æˆ‘å–œæ¬¢ä½  â¤ï¸ <br>ä»è¿™ä¸€åˆ»èµ·ï¼Œåªæƒ³å®ˆæŠ¤ä½ ã€‚"
];

const music = document.getElementById("bgMusic");
const clickSound = document.getElementById("clickSound");
const hint = document.getElementById("hint");

// åˆå§‹åŒ–æ˜Ÿæ˜Ÿ
for (let i = 0; i < 300; i++) {
    stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        size: Math.random() * 2,
        dx: Math.random() * 0.6 - 0.3,
        dy: Math.random() * 0.6 - 0.3
    });
}

// å¿ƒå½¢è·¯å¾„
for (let a = 0; a < Math.PI * 2; a += 0.1) {
    let x = 16 * Math.pow(Math.sin(a), 3);
    let y = 13 * Math.cos(a) - 5 * Math.cos(2*a) - 2 * Math.cos(3*a) - Math.cos(4*a);
    heart.push({x: x, y: -y});
}

// é¼ æ ‡ä½ç½®
let pointer = {x: canvas.width/2, y: canvas.height/2};
document.addEventListener('mousemove', (e)=>{
    pointer.x = e.clientX;
    pointer.y = e.clientY;
});

// å‡çº§ç‰ˆåœ£è¯çˆ±å¿ƒæ ‘
let treeHearts = [];
function drawChristmasTree() {
    const treeX = canvas.width - 180;
    const treeY = canvas.height - 180;
    const layers = 4; // æ ‘å±‚æ•°
    const layerHeight = 30;
    const baseWidth = 80;

    // ç»˜åˆ¶æ ‘å¶å±‚
    for (let i=0; i<layers; i++){
        ctx.beginPath();
        let w = baseWidth - i*15;
        let h = layerHeight;
        ctx.moveTo(treeX, treeY - i*h);
        ctx.lineTo(treeX - w/2, treeY + h - i*h);
        ctx.lineTo(treeX + w/2, treeY + h - i*h);
        ctx.closePath();
        ctx.fillStyle = "rgba(0,200,0,0.9)";
        ctx.shadowColor = "#0f0";
        ctx.shadowBlur = 10;
        ctx.fill();
    }

    // æ ‘å¹²
    ctx.fillStyle = "#8B4513";
    ctx.fillRect(treeX - 12, treeY + 10, 24, 40);

    // æ ‘é¡¶æ˜Ÿæ˜Ÿ
    ctx.beginPath();
    ctx.arc(treeX, treeY - layers*layerHeight - 5, 6, 0, Math.PI*2);
    ctx.fillStyle = "yellow";
    ctx.shadowColor = "yellow";
    ctx.shadowBlur = 15;
    ctx.fill();

    // çˆ±å¿ƒè£…é¥°é—ªçƒ
    if(treeHearts.length < 10){
        for(let i=0;i<10-treeHearts.length;i++){
            let offsetX = Math.random()*baseWidth - baseWidth/2;
            let offsetY = Math.random()*layers*layerHeight - layers*layerHeight;
            treeHearts.push({x: treeX + offsetX, y: treeY + offsetY, alpha: Math.random(), delta: 0.02 + Math.random()*0.03});
        }
    }

    treeHearts.forEach(h=>{
        h.alpha += h.delta;
        if(h.alpha > 1 || h.alpha < 0) h.delta *= -1;
        ctx.beginPath();
        ctx.arc(h.x, h.y, 5, 0, Math.PI*2);
        ctx.fillStyle = `rgba(255,0,0,${h.alpha})`;
        ctx.fill();
    });
}

// ç»˜åˆ¶æ˜Ÿæ˜Ÿã€é£˜è½çˆ±å¿ƒã€åœ£è¯æ ‘
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // æ˜Ÿæ˜Ÿ
    for (let s of stars) {
        s.x += s.dx;
        s.y += s.dy;
        if(s.x<0||s.x>canvas.width) s.dx*=-1;
        if(s.y<0||s.y>canvas.height) s.dy*=-1;
        ctx.beginPath();
        ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
        ctx.fillStyle="rgba(255,255,255,0.9)";
        ctx.shadowColor="#fff";
        ctx.shadowBlur=8;
        ctx.fill();
        s.x += (pointer.x - s.x) * 0.0005;
        s.y += (pointer.y - s.y) * 0.0005;
    }

    // é£˜è½çˆ±å¿ƒ
    for (let i=floatingHearts.length-1;i>=0;i--){
        let h=floatingHearts[i];
        h.y-=h.speed;
        h.alpha-=0.005;
        ctx.beginPath();
        ctx.arc(h.x,h.y,h.size,0,Math.PI*2);
        ctx.fillStyle=`rgba(255,0,0,${h.alpha})`;
        ctx.fill();
        if(h.alpha<=0) floatingHearts.splice(i,1);
    }

    // åœ£è¯æ ‘
    drawChristmasTree();

    requestAnimationFrame(draw);
}
draw();

// æ–‡å­—é€å­—æ˜¾ç¤º
function typeWriter(text, i=0) {
    const msg = document.getElementById("message");
    if(i < text.length){
        msg.innerHTML = text.substring(0,i+1);
        msg.style.opacity = 1;
        msg.style.textShadow = `0 0 ${8 + i/4}px #fff`;
        setTimeout(()=>typeWriter(text,i+1),40);
    }
}

// ç‚¹å‡»äº‹ä»¶
canvas.addEventListener("click", ()=>{
    hint.style.display = "none";

    if(music.paused){
        music.muted = false; 
        music.play().catch(err => console.log("æ’­æ”¾å—é™:", err));
    }

    clickSound.currentTime = 0;
    clickSound.play().catch(err => console.log("ç‚¹å‡»éŸ³æ•ˆå—é™:", err));

    clickCount++;
    let cx=canvas.width/2, cy=canvas.height/2;

    if(clickCount===1){
        // æ˜Ÿå…‰æ±‡èšå¿ƒå½¢
        stars.forEach((s,i)=>{
            let target=heart[i%heart.length];
            setInterval(()=>{
                s.x+=(cx+target.x*15-s.x)*0.05;
                s.y+=(cy+target.y*15-s.y)*0.05;
            },20);
        });
        // é£˜è½çˆ±å¿ƒ
        setInterval(()=>{
            floatingHearts.push({x:Math.random()*canvas.width, y:canvas.height, size:5+Math.random()*5, speed:1+Math.random()*1.5, alpha:1});
        },150);
        typeWriter(messageText[0]);
    }else if(clickCount===2){
        typeWriter(messageText[1]);
    }else if(clickCount===3){
        typeWriter(messageText[2]);
    }
});
</script>

</body>
</html>
