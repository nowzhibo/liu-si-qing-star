<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>åˆ˜æ€æ™´çš„ä¸“å±æ˜Ÿç©ºå‘Šç™½</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, #0a0f2c, #000);
    font-family: "Microsoft YaHei", sans-serif;
}
#message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-family: "PingFang SC","Microsoft YaHei",sans-serif;
    font-size: 4vw;          /* å“åº”å¼å­—ä½“ï¼Œæ‰‹æœºå±å¹•è‡ªé€‚åº” */
    font-weight: 300;
    text-align: center;
    line-height: 1.8;
    opacity: 0;
    text-shadow: 0 0 12px rgba(255,255,255,0.8);
    padding: 0 12px;
    word-break: break-word;
}
#hint {
    position: absolute;
    bottom: 20px;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 3.5vw;       /* å°å±å­—ä½“ */
    opacity: 0.7;
    text-shadow: 0 0 8px rgba(255,255,255,0.5);
}

canvas {
    display: block;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="message"></div>
<div id="hint">ğŸ’« ç‚¹å‡»å±å¹•ï¼Œå¼€å¯ä¸“å±æ˜Ÿç©ºæµªæ¼«éŸ³ä¹ ğŸ’«</div>

<audio id="bgMusic" loop playsinline preload="auto" muted>
  <source src="https://cdn.jsdelivr.net/gh/huqing/river_flows_in_you.mp3" type="audio/mpeg">
</audio>
<audio id="clickSound" preload="auto">
  <source src="https://cdn.jsdelivr.net/gh/huqing/click.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W;
canvas.height = H;

window.addEventListener('resize', ()=>{
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
    treeX = W - 120;
    treeY = H - 150;
});

// æ˜Ÿæ˜Ÿ
let stars = [];
for(let i=0;i<200;i++){
    stars.push({
        x: Math.random()*W,
        y: Math.random()*H,
        size: Math.random()*2,
        dx: Math.random()*0.5-0.25,
        dy: Math.random()*0.5-0.25
    });
}

// å¿ƒå½¢è·¯å¾„
let heart = [];
for(let a=0; a<Math.PI*2; a+=0.1){
    let x = 16*Math.pow(Math.sin(a),3);
    let y = 13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a);
    heart.push({x:x, y:-y});
}

// é£˜è½çˆ±å¿ƒ
let floatingHearts = [];

// åœ£è¯æ ‘è£…é¥°
let treeDecorations = [];
for(let i=0;i<5;i++){
    treeDecorations.push({
        x: Math.random()*60-30,
        y: Math.random()*50-20
    });
}
let treeX = W - 120;
let treeY = H - 150;

// é¼ æ ‡/æ‰‹æŒ‡ä½ç½®
let pointer = {x: W/2, y: H/2};
document.addEventListener('mousemove', e=>{pointer.x=e.clientX; pointer.y=e.clientY;});
document.addEventListener('touchmove', e=>{pointer.x=e.touches[0].clientX; pointer.y=e.touches[0].clientY;});

// ç»˜åˆ¶åœ£è¯æ ‘
function drawChristmasTree(){
    // æ ‘å¶
    for(let i=0;i<3;i++){
        ctx.beginPath();
        ctx.moveTo(treeX, treeY - i*30);
        ctx.lineTo(treeX - 40 + i*10, treeY + 30 - i*30);
        ctx.lineTo(treeX + 40 - i*10, treeY + 30 - i*30);
        ctx.closePath();
        ctx.fillStyle = 'rgba(0,255,0,0.8)';
        ctx.fill();
    }
    // æ ‘å¹²
    ctx.fillStyle = "#8B4513";
    ctx.fillRect(treeX-10, treeY+30, 20, 30);
    // çº¢è‰²è£…é¥°
    treeDecorations.forEach(d=>{
        ctx.beginPath();
        ctx.arc(treeX+d.x, treeY+d.y, 5, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(255,0,0,0.8)';
        ctx.fill();
    });
}

// ç»˜åˆ¶åŠ¨ç”»
function draw(){
    ctx.clearRect(0,0,W,H);

    // æ˜Ÿæ˜Ÿ
    stars.forEach(s=>{
        s.x += s.dx;
        s.y += s.dy;
        if(s.x<0||s.x>W) s.dx*=-1;
        if(s.y<0||s.y>H) s.dy*=-1;
        ctx.beginPath();
        ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
        ctx.fillStyle="rgba(255,255,255,0.9)";
        ctx.shadowColor="#fff";
        ctx.shadowBlur=8;
        ctx.fill();
        // æ˜Ÿæ˜Ÿè½»å¾®è·Ÿéšæ‰‹æŒ‡
        s.x += (pointer.x - s.x)*0.0005;
        s.y += (pointer.y - s.y)*0.0005;
    });

    // é£˜è½çˆ±å¿ƒ
    for(let i=floatingHearts.length-1;i>=0;i--){
        let h=floatingHearts[i];
        h.y -= h.speed;
        h.alpha -= 0.005;
        ctx.beginPath();
        ctx.arc(h.x,h.y,h.size,0,Math.PI*2);
        ctx.fillStyle = `rgba(255,0,0,${h.alpha})`;
        ctx.fill();
        if(h.alpha<=0) floatingHearts.splice(i,1);
    }

    // åœ£è¯æ ‘
    drawChristmasTree();

    requestAnimationFrame(draw);
}
draw();

// æ–‡å­—
const messageText=[
  "åˆ˜æ€æ™´ï¼Œä½ ä¸ç”¨å†ç‹¬è‡ªæ‰¿æ‹…ä¸€åˆ‡ï¼Œ<br>æ— è®ºå¼€å¿ƒæˆ–éš¾è¿‡ï¼Œæˆ‘éƒ½åœ¨ä½ èº«è¾¹ã€‚<br>æ¯ä¸€é¢—é—ªçƒçš„æ˜Ÿæ˜Ÿï¼Œéƒ½æ˜¯æˆ‘å¯¹ä½ çš„å¿ƒæ„ã€‚<br>æˆ‘å–œæ¬¢ä½ ï¼Œä¹Ÿæ„¿æ„é™ªç€ä½ ï¼Œç»™ä½ æ¸©æš–å’Œå®‰å…¨æ„Ÿã€‚",
  "å¦‚æœå¯ä»¥ï¼Œæˆ‘å¸Œæœ›æ¯å¤©éƒ½è¿™æ ·é™ªä½ ï¼Œçœ‹æ˜Ÿç©ºã€å¬éŸ³ä¹ï¼Œå“ªæ€•é™é™åœ°åç€ï¼Œä¹Ÿè§‰å¾—å¹¸ç¦ã€‚",
  "æ‰€ä»¥â€¦æˆ‘å–œæ¬¢ä½  â¤ï¸ ä»è¿™ä¸€åˆ»èµ·ï¼Œåªæƒ³å®ˆæŠ¤ä½ ã€‚"
];
function typeWriter(text,i=0){
    const msg = document.getElementById("message");
    if(i<text.length){
        msg.innerHTML = text.substring(0,i+1);
        msg.style.opacity = 1;
        msg.style.textShadow = `0 0 ${8+i/4}px #fff`;
        setTimeout(()=>typeWriter(text,i+1),40);
    }
}

// ç‚¹å‡»äº‹ä»¶
let clickCount=0;
const music = document.getElementById("bgMusic");
const clickSound = document.getElementById("clickSound");
const hint = document.getElementById("hint");

canvas.addEventListener("click", ()=>{
    hint.style.display = "none";

    if(music.paused){
        music.muted=false;
        music.play().catch(err=>console.log("æ’­æ”¾å—é™:",err));
    }

    clickSound.currentTime=0;
    clickSound.play().catch(err=>console.log("ç‚¹å‡»éŸ³æ•ˆå—é™:",err));

    clickCount++;
    let cx=W/2, cy=H/2;

    if(clickCount===1){
        // æ˜Ÿå…‰æ±‡èšå¿ƒå½¢
        stars.forEach((s,i)=>{
            s.target = heart[i%heart.length];
        });
        // é£˜è½çˆ±å¿ƒ
        setInterval(()=>{
            floatingHearts.push({
                x:Math.random()*W,
                y:H,
                size:5+Math.random()*5,
                speed:1+Math.random()*1.5,
                alpha:1
            });
        },150);
        // æ˜Ÿæ˜Ÿé è¿‘å¿ƒå½¢
        function updateStars(){
            stars.forEach(s=>{
                if(s.target){
                    s.x += (cx + s.target.x*15 - s.x)*0.05;
                    s.y += (cy + s.target.y*15 - s.y)*0.05;
                }
            });
            requestAnimationFrame(updateStars);
        }
        updateStars();

        typeWriter(messageText[0]);
    }else if(clickCount===2){
        typeWriter(messageText[1]);
    }else if(clickCount===3){
        typeWriter(messageText[2]);
    }
});
</script>

</body>
</html>
